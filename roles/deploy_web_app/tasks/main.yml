---
- name: Install yum-utils
  yum:
    name: yum-utils
    state: latest  
      
- name: Install device-mapper
  yum:
    name: device-mapper-persistent-data
    state: latest
      
- name: Install lvm2
  yum:
    name: lvm2
    state: latest
      
- name: Add repository      
  yum_repository:
    name: docker-ce.repo           
    description: YUM repo
    baseurl: yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

- name: Install docker-ce
  yum: 
    name: docker-ce  
    state: latest

- name: Install python modules for docker
  pip:
   name: docker-py
   state: present
  
- name: Service Docker start
  service: 
    name: docker
    state: started
    
- name: Autostart Docker service
  service: 
    name: docker
    enabled: yes

- name: Docker login
  shell: docker login -p esu0mtaeB -u beatmouse

    #- name: Log into DockerHub
    # docker_login:
    #registry: hub.docker.com      
    #username: beatmouse
    #password: esu0mtaeB
    #api_version: 1 

- name: Pull app image from DockerHub
  docker_image:
    name: beatmouse/app:latest

- name: Run app container
  docker_container:
    name: "{{ item.name }}"          
    detach: yes
    ports: "{{ item.ports }}" 
    #tty: yes
    #interactive: yes
    image: beatmouse/app:latest
  with_items:
  - { name: 'app1', ports: '5551:5000' }
  - { name: 'app2', ports: '5552:5000' }
  - { name: 'app3', ports: '5553:5000' }

